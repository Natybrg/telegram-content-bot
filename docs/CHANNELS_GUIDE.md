# 📚 מדריך מפורט: ניהול ערוצים וקבוצות

## 🎯 סקירה כללית

המערכת מאפשרת ניהול גמיש של ערוצי טלגרם וקבוצות וואטסאפ, עם שליטה מדויקת על אילו תבניות נשלחות לאילו ערוצים/קבוצות.

---

## 📋 מבנה המערכת

### **ערוצים/קבוצות קבועים (תמיד פעילים)**
ערוצים/קבוצות אלה מוגדרים ב-`.env` ותמיד מקבלים את ההודעות:

**טלגרם:**
- `AUDIO_CONTENT_CHANNEL_ID` - ערוץ סינגלים (פרטי)
- `VIDEO_CONTENT_CHANNEL_ID` - ערוץ קליפים (פרטי)

**וואטסאפ:**
- `WHATSAPP_CHAT_NAME` - קבוצה פרטית אחת

**⚠️ חשוב:** ערוצים/קבוצות אלה לא מופיעים במאגר ולא ניתן לערוך אותם דרך הבוט.

### **מאגר ערוצים/קבוצות (ניתן לעריכה)**
מאגר משותף לכל התבניות, ניתן להוסיף/להסיר דרך הבוט.

### **קישורים לתבניות**
כל תבנית יכולה להיות מקושרת לערוצים/קבוצות מהמאגר:
- ✅ **V** = פעיל (ההודעה תישלח)
- ❌ **X** = לא פעיל (ההודעה לא תישלח)

---

## 🚀 איך להשתמש

### **שלב 1: הוספת ערוצים/קבוצות למאגר**

1. פתח את הבוט ושלוח `/settings`
2. לחץ על **"➕ הוספת ערוצים/קבוצות"**
3. בחר פלטפורמה:
   - **📱 טלגרם** - להוספת ערוצי טלגרם
   - **💬 וואטסאפ** - להוספת קבוצות וואטסאפ

#### **הוספת ערוץ טלגרם:**

**פורמטים מקובלים:**
- `@channel_name` - שם משתמש של הערוץ
- `-1001234567890` - ID מספרי של הערוץ
- `https://t.me/channel_name` - קישור מלא לערוץ

**דוגמאות:**
```
@my_music_channel
-1001456991762
https://t.me/public_music
```

**⚠️ דרישות בסיסיות:**
- הערוץ חייב להיות **ציבורי** (public channel) **או** ה-Userbot חייב להיות **חבר** בערוץ
- ה-Userbot חייב להיות **מנהל** בערוץ (עם הרשאות פרסום) **או** לפחות חבר בערוץ עם הרשאות שליחה

**📋 מדריך שלב אחר שלב להוספת ערוץ טלגרם:**

##### **שלב 1: הכנת הערוץ**
1. **וודא שה-Userbot חבר בערוץ:**
   - פתח את הערוץ בטלגרם
   - הוסף את ה-Userbot כחבר בערוץ (אם הערוץ פרטי)
   - או וודא שהערוץ ציבורי

2. **וודא שה-Userbot יכול לשלוח:**
   - אם הערוץ פרטי: ה-Userbot חייב להיות חבר
   - אם הערוץ ציבורי: ה-Userbot יכול לשלוח גם בלי להיות חבר (אבל עדיף להיות חבר)

##### **שלב 2: טעינת הערוץ ל-Storage של Pyrogram**
**⚠️ זה השלב החשוב ביותר!** Pyrogram צריך "להכיר" את הערוץ לפני שהוא יכול לשלוח אליו.

**איך לטעון את הערוץ ל-Storage:**
1. **שלח הודעה מהערוץ ל-Userbot:**
   - פתח את הערוץ בטלגרם
   - שלח הודעה כלשהי מהערוץ (למשל: "test" או "היי")
   - **חשוב:** ההודעה חייבת להישלח **מהערוץ** (לא מהמשתמש שלך)
   - אם הערוץ לא יכול לשלוח הודעות, הוסף את ה-Userbot כחבר בערוץ

2. **או שלח הודעה מה-Userbot לערוץ:**
   - פתח את ה-Userbot בטלגרם
   - שלח הודעה כלשהי לערוץ (למשל: "test" או "היי")
   - זה יטען את הערוץ ל-Storage

3. **או השתמש ב-`@getidsbot`:**
   - שלח את ה-Userbot לערוץ
   - שלח `/start` ל-`@getidsbot` בערוץ
   - זה יטען את הערוץ ל-Storage

**💡 טיפ:** הדרך הכי בטוחה היא לשלוח הודעה מה-Userbot לערוץ לפני הוספת הערוץ לבוט.

##### **שלב 3: מציאת ה-ID של הערוץ**
**אם הערוץ ציבורי:**
1. פתח את הערוץ בטלגרם
2. העתק קישור לערוץ (לחיצה ימנית → "Copy Link")
3. הקישור יהיה בפורמט: `https://t.me/channel_name`
4. השתמש ב-`@channel_name` או `channel_name`

**אם הערוץ פרטי:**
1. פתח את הערוץ בטלגרם
2. לחץ על שם הערוץ בחלק העליון
3. העתק את ה-ID (אם מופיע)
4. או השתמש ב-`@userinfobot` או `@getidsbot`:
   - שלח את ה-Userbot לערוץ
   - שלח `/start` ל-`@userinfobot` או `@getidsbot` בערוץ
   - הבוט יראה לך את ה-ID של הערוץ

##### **שלב 4: הוספת הערוץ לבוט**
1. פתח את הבוט ושלוח `/settings`
2. לחץ על **"➕ הוספת ערוצים/קבוצות"**
3. בחר **"📱 טלגרם"**
4. שלח את ה-ID או שם הערוץ:
   - `@channel_name` (אם הערוץ ציבורי)
   - `-1001234567890` (ID מספרי)
   - `https://t.me/channel_name` (קישור מלא)

##### **שלב 5: בדיקה שהערוץ עובד**
1. הוסף את הערוץ לתבנית (למשל `telegram_video`)
2. נסה לשלוח תוכן דרך הבוט
3. אם יש שגיאה `PEER_ID_INVALID`, חזור לשלב 2 וטען את הערוץ ל-Storage

**🔧 פתרון בעיות נפוצות:**

**שגיאה: `PEER_ID_INVALID`**
- **פתרון:** שלח הודעה מה-Userbot לערוץ לפני הוספת הערוץ לבוט
- או שלח הודעה מהערוץ ל-Userbot

**שגיאה: `CHANNEL_INVALID`**
- **פתרון:** וודא שה-Userbot חבר בערוץ (אם הערוץ פרטי)
- או וודא שהערוץ קיים וציבורי

**שגיאה: `CHAT_ADMIN_REQUIRED`**
- **פתרון:** ה-Userbot צריך להיות מנהל בערוץ עם הרשאות פרסום
- או לפחות חבר בערוץ עם הרשאות שליחה

#### **הוספת קבוצת וואטסאפ:**

**פורמט:**
- שם הקבוצה **בדיוק** כפי שהוא מופיע בוואטסאפ

**דוגמאות:**
```
ניהול בוט
קבוצת עבודה 🎵
Music Group 2024
```

**⚠️ חשוב מאוד:**
- ✅ שם הקבוצה חייב להתאים **בדיוק** (100%)
- ✅ כולל אימוג'ים, מספרים, רווחים
- ✅ כולל אותיות גדולות/קטנות
- ❌ לא לשכוח רווחים
- ❌ לא לשכוח אימוג'ים

**איך למצוא את השם המדויק:**
1. פתח את הקבוצה בוואטסאפ
2. לחץ על שם הקבוצה בחלק העליון
3. העתק את השם **בדיוק** כפי שהוא מופיע
4. אם יש אימוג'ים - העתק גם אותם

**טיפים:**
- בדוק שהשם זהה לחלוטין (אפילו רווח אחד יכול לגרום לכשל)
- אם יש אימוג'ים, ודא שהם מועתקים נכון
- אם יש מספרים, ודא שהם זהים

---

### **שלב 2: קישור ערוצים/קבוצות לתבניות**

לאחר שהוספת ערוצים/קבוצות למאגר, תוכל לקשר אותם לתבניות:

1. פתח `/settings`
2. לחץ על **"📝 ערוך תבניות"**
3. בחר תבנית (למשל: **"📱 תמונה וואטסאפ"**)
4. לחץ על **"📢 ערוך ערוצים/קבוצות"**
5. תראה רשימת כל הערוצים/קבוצות מהמאגר
6. לחץ על כל ערוץ/קבוצה כדי להחליף בין ❌ (לא פעיל) ל-✅ (פעיל)

**דוגמה:**
- תבנית **"📱 תמונה וואטסאפ"**:
  - קבוצה A = ✅ (פעיל)
  - קבוצה B = ❌ (לא פעיל)
- תבנית **"🎵 שיר וואטסאפ"**:
  - קבוצה A = ❌ (לא פעיל)
  - קבוצה B = ✅ (פעיל)

**תוצאה:**
- כשמעלים תמונה → נשלח לקבוצה A בלבד
- כשמעלים שיר → נשלח לקבוצה B בלבד

---

## 📊 תבניות זמינות

### **טלגרם:**
1. **📤 תמונה טלגרם** (`telegram_image`)
   - נשלח עם תמונה + MP3
   - ערוצים: קבועים + מהמאגר (לפי הגדרות)

2. **🎵 שיר טלגרם** (`telegram_audio`)
   - נשלח עם MP3
   - ערוצים: קבועים + מהמאגר (לפי הגדרות)

3. **🎬 קליפ טלגרם** (`telegram_video`)
   - נשלח עם וידאו
   - ערוצים: קבועים + מהמאגר (לפי הגדרות)

### **וואטסאפ:**
1. **📱 תמונה וואטסאפ** (`whatsapp_image`)
   - נשלח עם תמונה + MP3
   - קבוצות: קבועה + מהמאגר (לפי הגדרות)

2. **🎵 שיר וואטסאפ** (`whatsapp_audio`)
   - נשלח עם MP3
   - קבוצות: קבועה + מהמאגר (לפי הגדרות)

3. **🎬 קליפ וואטסאפ** (`whatsapp_video`)
   - נשלח עם וידאו
   - קבוצות: קבועה + מהמאגר (לפי הגדרות)

---

## 🔧 ניהול המאגר

### **הצגת ערוצים/קבוצות קיימים:**
1. `/settings` → **"➕ הוספת ערוצים/קבוצות"**
2. אם יש ערוצים/קבוצות במאגר, תראה כפתור **"📋 ניהול"**
3. לחץ עליו כדי לראות את הרשימה

### **הסרת ערוץ/קבוצה מהמאגר:**
1. פתח את תפריט הניהול
2. לחץ על הערוץ/הקבוצה שברצונך להסיר
3. הערוץ/הקבוצה יוסר מהמאגר
4. **⚠️ שים לב:** ההסרה תסיר גם את כל הקישורים לתבניות

---

## ⚡ אופטימיזציות

### **טלגרם - שימוש ב-file_id:**
- **העלאה פעם אחת** לערוץ הראשון (או LOG_CHANNEL_ID)
- **שימוש ב-file_id** לשאר הערוצים
- **תוצאה:** 
  - ✅ חיסכון ב-bandwidth (0% העלאה נוספת)
  - ✅ הודעות נראות מקוריות (ללא "Forwarded")
  - ✅ מהיר יותר

### **וואטסאפ - העלאה מחדש:**
- **העלאה מחדש** לכל קבוצה בנפרד
- **תוצאה:**
  - ✅ הודעות נראות מקוריות (ללא "Forwarded")
  - ⚠️ דורש יותר bandwidth (כל קבוצה = העלאה חדשה)

**הערה:** אם רוצים לחסוך bandwidth, אפשר להשתמש ב-`msg.forward(chatId)`, אבל זה יוסיף את הסימון "Forwarded".

---

## 📝 דוגמאות שימוש

### **דוגמה 1: ערוץ טלגרם ציבורי**

**מטרה:** להוסיף ערוץ ציבורי שיקבל תמונות וסינגלים

**צעדים:**
1. הוסף ערוץ למאגר:
   - `/settings` → **"➕ הוספת ערוצים/קבוצות"** → **"📱 טלגרם"**
   - שלח: `@public_music_channel`
2. קשר לתבניות:
   - `/settings` → **"📝 ערוך תבניות"** → **"📤 תמונה טלגרם"**
   - לחץ **"📢 ערוך ערוצים/קבוצות"**
   - לחץ על `@public_music_channel` כדי להפוך ל-✅

**תוצאה:** כל תמונה + MP3 יישלחו גם לערוץ הציבורי.

---

### **דוגמה 2: מספר קבוצות וואטסאפ**

**מטרה:** לשלוח תמונות לקבוצה A, שירים לקבוצה B, קליפים לקבוצה C

**צעדים:**
1. הוסף קבוצות למאגר:
   - `/settings` → **"➕ הוספת ערוצים/קבוצות"** → **"💬 וואטסאפ"**
   - שלח: `קבוצת תמונות 📸`
   - שלח: `קבוצת שירים 🎵`
   - שלח: `קבוצת קליפים 🎬`

2. קשר לתבניות:
   - **תמונה וואטסאפ:** `קבוצת תמונות 📸` = ✅
   - **שיר וואטסאפ:** `קבוצת שירים 🎵` = ✅
   - **קליפ וואטסאפ:** `קבוצת קליפים 🎬` = ✅

**תוצאה:** כל סוג תוכן יישלח לקבוצה המתאימה.

---

### **דוגמה 3: ערוץ טלגרם עם ID מספרי**

**מטרה:** להוסיף ערוץ פרטי/ציבורי עם ID מספרי

**צעדים:**
1. מצא את ה-ID:
   - פתח את הערוץ
   - העתק קישור → `https://t.me/c/1234567890/1`
   - ה-ID הוא: `-1001234567890` (הוסף `-100` בהתחלה)
   - או השתמש ב-`@getidsbot`

2. הוסף למאגר:
   - `/settings` → **"➕ הוספת ערוצים/קבוצות"** → **"📱 טלגרם"**
   - שלח: `-1001234567890`

3. קשר לתבניות (כמו בדוגמה 1)

---

## ⚠️ בעיות נפוצות ופתרונות

### **בעיה: "Failed to send to channel"**

**סיבות אפשריות:**
1. ה-Userbot לא מנהל בערוץ
2. הערוץ לא קיים או לא נגיש
3. ID שגוי

**פתרון:**
- ודא שה-Userbot מנהל בערוץ
- בדוק שה-ID/שם נכון
- נסה עם שם משתמש במקום ID

---

### **בעיה: "קבוצה לא נמצאה" בוואטסאפ**

**סיבות אפשריות:**
1. שם הקבוצה לא מדויק
2. הקבוצה לא קיימת
3. המשתמש לא חבר בקבוצה

**פתרון:**
- העתק את השם **בדיוק** כפי שהוא מופיע
- ודא שיש רווחים/אימוג'ים נכונים
- ודא שהמשתמש (שדרכו מעלים) חבר בקבוצה

---

### **בעיה: "Channel/group not in repository"**

**סיבה:** ניסית לקשר ערוץ/קבוצה לתבנית לפני שהוספת אותו למאגר.

**פתרון:**
1. הוסף את הערוץ/הקבוצה למאגר תחילה
2. רק אחר כך קשר אותו לתבנית

---

## 📁 מבנה הקבצים

### **`channels.json`**
קובץ JSON שמכיל:
```json
{
  "repository": {
    "telegram": ["@channel1", "-1001234567890"],
    "whatsapp": ["קבוצה A", "קבוצה B 🎵"]
  },
  "template_links": {
    "telegram_image": {
      "telegram": ["@channel1"],
      "whatsapp": []
    },
    "whatsapp_image": {
      "telegram": [],
      "whatsapp": ["קבוצה A"]
    }
  }
}
```

**⚠️ לא לערוך ידנית!** השתמש בבוט לעריכה.

---

## 🔐 אבטחה והרשאות

- רק משתמשים מורשים (`ADMIN_ID`) יכולים לערוך
- כל השינויים נשמרים אוטומטית
- אין גישה חיצונית לקבצים

---

## 📞 תמיכה

אם נתקלת בבעיה:
1. בדוק את הלוגים (`bot.log`)
2. ודא שהכל מוגדר נכון
3. נסה להסיר ולהוסיף מחדש

---

**✅ המערכת מוכנה לשימוש!**

